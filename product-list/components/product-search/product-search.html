<link rel="import" href="../vendor/polymer/polymer.html">
<link rel="import" href="../vendor/core-ajax/core-ajax.html">

<polymer-element name="product-search" attributes="products filtered">
  <template>
    <style>
      form {
        margin-bottom: 3em;
      }
      label {
        color: #999;
        display: block;
        margin-bottom: 0.5em;
      }
      input {
        -o-box-sizing: border-box;
        -ms-box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        display: block;
        font-size: 1.2em;
        padding: 0.5em;
        width: 100%;
      }
    </style>
    <form>
      <label for="query">Search:</label>
      <input autofocus type="text" id="query" value="{{query}}" on-keyup="{{search}}">
    </form>
  </template>
  <script type="text/javascript">
    Polymer({
      ready: function () {
        this.filtered = this.filtered || [];
        this.products = this.products || [];
        console.log('Initial products:', this.products);
        this.$.query.focus();
      },
      search: function (e) {
        console.log('Search:', this.query);
        var regex = new RegExp(this.query, 'i');
        this.filtered = this.products.filter(function (product) {
          return regex.test(product.name);
        });
        console.log('Filtered products:', this.filtered);
      },
    });
  </script>
</polymer-element>
